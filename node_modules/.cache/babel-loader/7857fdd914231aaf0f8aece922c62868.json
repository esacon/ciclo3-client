{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Enrique Niebles/Documents/Misi\\xF3n TIC 2021/Ciclo 3 - Desarrollo Software/Heroku/client/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/Enrique Niebles/Documents/Misi\\xF3n TIC 2021/Ciclo 3 - Desarrollo Software/Heroku/client/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Enrique Niebles/Documents/Misi\\xF3n TIC 2021/Ciclo 3 - Desarrollo Software/Heroku/client/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{createContext,useState,useCallback,useMemo}from\"react\";import cookie from'react-cookies';import{jsx as _jsx}from\"react/jsx-runtime\";var _require=require('google-auth-library'),OAuth2Client=_require.OAuth2Client;var CLIENT_ID='819657394751-viq5524nlnaulgi12eh0t2jgsvd8jofo.apps.googleusercontent.com';var LOGIN_ADMIN='LOGIN_ADMIN';var LOGIN_VENDEDOR='LOGIN_VENDEDOR';export var AuthContext=/*#__PURE__*/createContext();export default function AuthContextProvider(_ref){var children=_ref.children;var _useState=useState(window.localStorage.getItem(LOGIN_ADMIN)),_useState2=_slicedToArray(_useState,2),isAdminAuthenticated=_useState2[0],setIsAdminAuthenticated=_useState2[1];var _useState3=useState(window.localStorage.getItem(LOGIN_VENDEDOR)),_useState4=_slicedToArray(_useState3,2),isAuthenticated=_useState4[0],setIsAuthenticated=_useState4[1];var login=useCallback(function(){var client=new OAuth2Client(CLIENT_ID);var token=cookie.load('token');var verify=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(token){var ticket,payload,userid;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return client.verifyIdToken({idToken:token,audience:CLIENT_ID});case 3:ticket=_context.sent;payload=ticket.getPayload();userid=payload['sub'];console.log('UserID: ',userid);window.localStorage.setItem(LOGIN_VENDEDOR,true);setIsAuthenticated(true);setIsAdminAuthenticated(true);return _context.abrupt(\"return\");case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);console.log('error',_context.t0);case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,13]]);}));return function verify(_x){return _ref2.apply(this,arguments);};}();verify(token);},[]);var loginAdmin=useCallback(function(){var client=new OAuth2Client(CLIENT_ID);var token=cookie.load('token');var verify=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(token){var ticket,payload,userid;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return client.verifyIdToken({idToken:token,audience:CLIENT_ID});case 3:ticket=_context2.sent;payload=ticket.getPayload();userid=payload['sub'];console.log('UserID: ',userid);setIsAdminAuthenticated(true);setIsAuthenticated(false);window.localStorage.setItem(LOGIN_ADMIN,true);window.localStorage.removeItem(LOGIN_VENDEDOR,true);return _context2.abrupt(\"return\");case 14:_context2.prev=14;_context2.t0=_context2[\"catch\"](0);console.log('error',_context2.t0);case 17:case\"end\":return _context2.stop();}}},_callee2,null,[[0,14]]);}));return function verify(_x2){return _ref3.apply(this,arguments);};}();verify(token);},[]);var logout=useCallback(function(){window.localStorage.removeItem(LOGIN_ADMIN,true);window.localStorage.removeItem(LOGIN_VENDEDOR,true);setIsAuthenticated(false);setIsAdminAuthenticated(false);},[]);var value=useMemo(function(){return{isAuthenticated:isAuthenticated,isAdminAuthenticated:isAdminAuthenticated,login:login,loginAdmin:loginAdmin,logout:logout};},[isAuthenticated,isAdminAuthenticated,login,loginAdmin,logout]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});}","map":{"version":3,"sources":["C:/Users/Enrique Niebles/Documents/MisiÃ³n TIC 2021/Ciclo 3 - Desarrollo Software/Heroku/client/react/src/components/login/auth/authContext.js"],"names":["createContext","useState","useCallback","useMemo","cookie","require","OAuth2Client","CLIENT_ID","LOGIN_ADMIN","LOGIN_VENDEDOR","AuthContext","AuthContextProvider","children","window","localStorage","getItem","isAdminAuthenticated","setIsAdminAuthenticated","isAuthenticated","setIsAuthenticated","login","client","token","load","verify","verifyIdToken","idToken","audience","ticket","payload","getPayload","userid","console","log","setItem","loginAdmin","removeItem","logout","value"],"mappings":"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","sourcesContent":["import { createContext, useState, useCallback, useMemo } from \"react\";\r\nimport PropTypes from 'prop-types';\r\nimport cookie from 'react-cookies';\r\nconst { OAuth2Client } = require('google-auth-library');\r\n\r\nconst CLIENT_ID = '819657394751-viq5524nlnaulgi12eh0t2jgsvd8jofo.apps.googleusercontent.com';\r\nconst LOGIN_ADMIN = 'LOGIN_ADMIN';\r\nconst LOGIN_VENDEDOR = 'LOGIN_VENDEDOR';\r\n\r\nexport const AuthContext = createContext();\r\nexport default function AuthContextProvider({children}) {    \r\n\r\n    const [isAdminAuthenticated, setIsAdminAuthenticated] = useState(window.localStorage.getItem(LOGIN_ADMIN));\r\n    const [isAuthenticated, setIsAuthenticated] = useState(window.localStorage.getItem(LOGIN_VENDEDOR));\r\n\r\n    const login = useCallback(() => {\r\n        const client = new OAuth2Client(CLIENT_ID);\r\n        const token = cookie.load('token');\r\n\r\n        const verify = async (token) => {\r\n            try {\r\n                const ticket = await client.verifyIdToken({\r\n                    idToken: token,\r\n                    audience: CLIENT_ID\r\n                });\r\n                const payload = ticket.getPayload();\r\n                const userid = payload['sub'];\r\n                console.log('UserID: ', userid);\r\n                window.localStorage.setItem(LOGIN_VENDEDOR, true);\r\n                setIsAuthenticated(true);\r\n                setIsAdminAuthenticated(true);\r\n                return;\r\n            } catch (error) {\r\n                console.log('error', error);\r\n            } \r\n        }\r\n        \r\n        verify(token);          \r\n    }, []);\r\n\r\n    const loginAdmin = useCallback(() => {\r\n        \r\n        const client = new OAuth2Client(CLIENT_ID);\r\n        const token = cookie.load('token');\r\n\r\n        const verify = async (token) => {\r\n            try {\r\n                const ticket = await client.verifyIdToken({\r\n                    idToken: token,\r\n                    audience: CLIENT_ID\r\n                });\r\n                const payload = ticket.getPayload();\r\n                const userid = payload['sub'];\r\n                console.log('UserID: ', userid);\r\n                setIsAdminAuthenticated(true);\r\n                setIsAuthenticated(false);\r\n                window.localStorage.setItem(LOGIN_ADMIN, true);\r\n                window.localStorage.removeItem(LOGIN_VENDEDOR, true);\r\n                return;\r\n            } catch (error) {\r\n                console.log('error', error);\r\n            } \r\n        }\r\n        \r\n        verify(token);  \r\n    }, []);\r\n\r\n    const logout = useCallback(() => {\r\n        window.localStorage.removeItem(LOGIN_ADMIN, true);\r\n        window.localStorage.removeItem(LOGIN_VENDEDOR, true);\r\n        setIsAuthenticated(false);\r\n        setIsAdminAuthenticated(false);\r\n    }, []);\r\n\r\n    const value = useMemo(() => ({\r\n        isAuthenticated,\r\n        isAdminAuthenticated,\r\n        login,\r\n        loginAdmin,\r\n        logout\r\n    }), [isAuthenticated, isAdminAuthenticated, login, loginAdmin, logout]);\r\n\r\n    return (\r\n        <AuthContext.Provider value={value}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n\r\nAuthContextProvider.propTypes = {\r\n    children: PropTypes.object\r\n};"]},"metadata":{},"sourceType":"module"}