{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Enrique Niebles/Documents/Misi\\xF3n TIC 2021/Ciclo 3 - Desarrollo Software/Heroku/client/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/Enrique Niebles/Documents/Misi\\xF3n TIC 2021/Ciclo 3 - Desarrollo Software/Heroku/client/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React from'react';import{useHistory}from'react-router';import GoogleLogin from'react-google-login';import cookie from'react-cookies';import LoginIcon from'../../images/user.png';import useAuthContext from'./auth/hooks/useAuthContext';import{rutas}from\"../../path\";import'../../App.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function sleep(ms){return new Promise(function(resolve){return setTimeout(resolve,ms);});}var Login=function Login(){var history=useHistory();var _useAuthContext=useAuthContext(),login=_useAuthContext.login,loginAdmin=_useAuthContext.loginAdmin,logout=_useAuthContext.logout;var responseGoogle=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var user,content;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!response.tokenId){_context.next=30;break;}_context.prev=1;cookie.save('token',response.tokenId);_context.next=5;return fetch('https://pub-ciclo3-server.herokuapp.com/api/addUser',{method:'POST',headers:{'Accept':'application/json','Content-Type':'application/json'},body:JSON.stringify({name:response.profileObj.name,lastname:response.profileObj.familyName,email:response.profileObj.email})});case 5:user=_context.sent;_context.next=8;return user.json();case 8:content=_context.sent;console.log(content);if(!(content.role===1)){_context.next=17;break;}console.log(\"Vendedor conectado.\");login();sleep(1000).then(function(){history.push(rutas.VENDEDOR);});return _context.abrupt(\"return\");case 17:if(!(content.role===2)){_context.next=22;break;}console.log(\"Administrador conectado.\");loginAdmin();sleep(1000).then(function(){history.push(rutas.ADMIN);});return _context.abrupt(\"return\");case 22:logout();console.log(\"Asignaci贸n pendiente.\");history.push(rutas.PENDIENTE);_context.next=30;break;case 27:_context.prev=27;_context.t0=_context[\"catch\"](1);console.log('error',_context.t0);case 30:case\"end\":return _context.stop();}}},_callee,null,[[1,27]]);}));return function responseGoogle(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{class:\"modal-dialog text-center\",children:/*#__PURE__*/_jsx(\"div\",{class:\"col-sm-8 main-section\",children:/*#__PURE__*/_jsxs(\"div\",{class:\"modal-content\",children:[/*#__PURE__*/_jsx(\"div\",{class:\"col-12 user-img\",children:/*#__PURE__*/_jsx(\"img\",{src:LoginIcon,alt:\"icon\"})}),/*#__PURE__*/_jsx(\"div\",{class:\"d-grid gap-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"loginBox\",children:[/*#__PURE__*/_jsx(\"h4\",{class:\"mg-l\",children:\"Inicie sesi\\xF3n: \"}),/*#__PURE__*/_jsx(GoogleLogin,{clientId:\"819657394751-viq5524nlnaulgi12eh0t2jgsvd8jofo.apps.googleusercontent.com\",buttonText:\"Login\",onSuccess:responseGoogle,onFailure:responseGoogle,cookiePolicy:'single_host_origin'})]})})]})})});};export default Login;","map":{"version":3,"sources":["C:/Users/Enrique Niebles/Documents/Misi贸n TIC 2021/Ciclo 3 - Desarrollo Software/Heroku/client/react/src/components/login/Login.js"],"names":["React","useHistory","GoogleLogin","cookie","LoginIcon","useAuthContext","rutas","sleep","ms","Promise","resolve","setTimeout","Login","history","login","loginAdmin","logout","responseGoogle","response","tokenId","save","fetch","method","headers","body","JSON","stringify","name","profileObj","lastname","familyName","email","user","json","content","console","log","role","then","push","VENDEDOR","ADMIN","PENDIENTE"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { useHistory } from 'react-router';\r\nimport GoogleLogin from 'react-google-login';\r\nimport cookie from 'react-cookies';\r\nimport LoginIcon from '../../images/user.png';\r\nimport useAuthContext from './auth/hooks/useAuthContext';\r\nimport { rutas } from \"../../path\";\r\nimport '../../App.css';\r\n\r\nfunction sleep(ms) {\r\n  return new Promise(resolve => setTimeout(resolve, ms));\r\n}\r\n\r\nconst Login = () => {\r\n\r\n    const history = useHistory();\r\n    const {login, loginAdmin, logout} = useAuthContext();\r\n\r\n    const responseGoogle = async (response) => {\r\n        if (response.tokenId) {\r\n            try {\r\n                cookie.save('token', response.tokenId);\r\n\r\n                const user = await fetch('https://pub-ciclo3-server.herokuapp.com/api/addUser', {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Accept': 'application/json',\r\n                        'Content-Type': 'application/json'\r\n                    },\r\n                    body: JSON.stringify({\r\n                        name: response.profileObj.name,\r\n                        lastname: response.profileObj.familyName,\r\n                        email: response.profileObj.email\r\n                    })\r\n                });\r\n\r\n                const content = await user.json();\r\n                console.log(content);\r\n                if (content.role === 1){\r\n                    console.log(\"Vendedor conectado.\");\r\n                    login();\r\n                    sleep(1000).then(() => { history.push(rutas.VENDEDOR); });     \r\n                    return;\r\n                } else if (content.role === 2) {\r\n                    console.log(\"Administrador conectado.\");\r\n                    loginAdmin();\r\n                    sleep(1000).then(() => { history.push(rutas.ADMIN); });\r\n                    return;\r\n                }\r\n\r\n                logout();\r\n                console.log(\"Asignaci贸n pendiente.\");\r\n                history.push(rutas.PENDIENTE);\r\n\r\n            } catch (error) {\r\n                console.log('error', error);\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div class=\"modal-dialog text-center\">\r\n            <div class=\"col-sm-8 main-section\">\r\n                <div class=\"modal-content\">\r\n                    <div class=\"col-12 user-img\">\r\n                        <img src={LoginIcon} alt=\"icon\" />\r\n                    </div>\r\n                    <div class=\"d-grid gap-2\">\r\n                        <div className=\"loginBox\">\r\n                            <h4 class=\"mg-l\">Inicie sesi贸n: </h4>\r\n                            <GoogleLogin\r\n                                clientId=\"819657394751-viq5524nlnaulgi12eh0t2jgsvd8jofo.apps.googleusercontent.com\"\r\n                                buttonText=\"Login\"\r\n                                onSuccess={responseGoogle}\r\n                                onFailure={responseGoogle}\r\n                                cookiePolicy={'single_host_origin'}\r\n                            />\r\n                        </div>                      \r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>        \r\n    );\r\n}\r\n\r\nexport default Login;\r\n"]},"metadata":{},"sourceType":"module"}